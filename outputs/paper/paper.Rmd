---
title: "My title"
subtitle: "My subtitle if needed"
author: 
  - First author
  - Another author
thanks: "Code and data are available at: LINK."
date: "`r format(Sys.time(), '%d %B %Y')`"
abstract: "First sentence. Second sentence. Third sentence. Fourth sentence."
output:
  bookdown::pdf_document2
toc: FALSE
bibliography: references.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(palmerpenguins)
```

# Introduction

You can and should cross-reference sections and sub-sections. For instance, Section \@ref(data). R Markdown automatically makes the sections lower case and adds a dash to spaces to generate labels, for instance, Section \@ref(first-discussion-point). 

\newpage
# Replications
```{r, echo=FALSE, warning=FALSE, message=FALSE}
# Replicate Figure 1
fig_1_data <- read_csv("~/US_birth_rates_folder/inputs/data/fig_1_data.csv")
```

```{r Figure1, fig.cap="*Source:* Birth Rates collected from CDC Vital Statistics Births Reports for 2015, 2019 and 2020. See Data Appendix for additional details.", echo=FALSE, warning=FALSE, message=FALSE}
fig_1_data %>%
  ggplot(aes(x = year, y = brate_all)) +
  geom_line(color = "dark blue") +
  geom_vline(xintercept = 2007, linetype="dashed") +
  geom_text(aes(x = 2007, label="2007", y = 70), nudge_x = 2.3, nudge_y = 1.5)+
  labs(title = "Trend in US Birth Rates") +
  scale_x_continuous(name = NULL, breaks = c(1980, 1985, 1990, 1995, 2000, 2005, 2010, 2015, 2020)) +
  scale_y_continuous(name = "Births per 1,000 women age 15â€“44", breaks = c(50, 55, 60, 65, 70, 75, 80), limits = c(50, 80)) +
  theme_minimal() +
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank())
```

```{r, echo=FALSE, warning=FALSE, message=FALSE}
# Replicate Figure 2
fig_2ab_data <- read_csv("~/US_birth_rates_folder/inputs/data/fig_2ab_data.csv")
```
```{r, echo=FALSE, warning=FALSE, message=FALSE}
df_2a <- fig_2ab_data %>%
  select(year, brate_1519, brate_2024, brate_2529, brate_3034, brate_3539, brate_4044) %>%
  gather(key = "variable", value = "value", -year)
```


```{r Figure2a, fig.cap="*Note*: Birth rates by age group are gathered from CDC Vital Statistics Births Reports. The Data Appendix provides detailed information on the specific data source.", echo=FALSE, warning=FALSE, message=FALSE}
df_2a %>%
  ggplot(aes(x = year, y = value)) + 
  geom_line(aes(color = variable)) +
  geom_vline(xintercept = 2007, linetype="dashed") +
  geom_text(aes(x = 2007, label="2007", y = 120), nudge_x = 2.3, nudge_y = 1.5) + labs(title = "a: Five-year age group") +
  scale_color_discrete(name = "Age Group",
                       limits = c("brate_1519", "brate_2024", "brate_2529", "brate_3034", "brate_3539", "brate_4044"),
                       labels = c("Age 15 - 19", "Age 20 - 24", "Age 25 - 29", "Age 30 - 34", "Age 35 - 39", "Age 40 - 44")) +
  scale_x_continuous(name = NULL, breaks = c(1980, 1985, 1990, 1995, 2000, 2005, 2010, 2015, 2020)) +
  scale_y_continuous(name = "Births per 1,000 women in different age groups", breaks = c(0, 20, 40, 60, 80, 100, 120, 140), limits = c(0, 140)) +
  theme_minimal() +
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank())
```

```{r, echo=FALSE, warning=FALSE, message=FALSE}
df_2b <- fig_2ab_data %>%
  select(year, brate_whitenh, brate_blacknh, brate_hisp) %>%
  gather(key = "variable", value = "value", -year) %>%
  drop_na()
```

```{r Figure2b, fig.cap="*Note*: Birth rates by race and ethnicity are gathered from CDC Vital Statistics Births Reports. The Data Appendix provides detailed information on the specific data source.", echo=FALSE, warning=FALSE, message=FALSE}
df_2b %>%
  ggplot(aes(x = year, y = value)) + 
  geom_line(aes(color = variable)) +
  geom_vline(xintercept = 2007, linetype="dashed") +
  geom_text(aes(x = 2007, label="2007", y = 130), nudge_x = 2.3, nudge_y = 1.5) + labs(title = "b: Race and ethnicity (ages 15 - 44)") +
  scale_color_discrete(name = "Race and Ethnicity Groups",
                       limits = c("brate_whitenh", "brate_blacknh", "brate_hisp"),
                       labels = c("White, non-Hispanic", "Black, non-Hispanic", "Hispanic")) +
  scale_x_continuous(name = NULL, breaks = c(1990, 1995, 2000, 2005, 2010, 2015, 2020)) +
  scale_y_continuous(name = "Births per 1,000 women in different race groups", breaks = c(0, 20, 40, 60, 80, 100, 120, 140), limits = c(0, 140)) +
  theme_minimal() +
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank())
```

```{r, echo=FALSE, warning=FALSE, message=FALSE}
# Replicate Figure 2e
fig_2c_data <- read_csv("~/US_birth_rates_folder/inputs/data/fig_2e_data.csv")
```

```{r, echo=FALSE, warning=FALSE, message=FALSE}
df_2c <- fig_2c_data %>%
  gather(key = "variable", value = "value", -year) %>%
  drop_na()
```


```{r Figure2e, fig.cap="*Note*: Birth rates by marital status are gathered from CDC Vital Statistics Births Reports. The Data Appendix provides detailed information on the specific data source.", echo=FALSE, warning=FALSE, message=FALSE}
df_2c %>%
  ggplot(aes(x = year, y = value)) + 
  geom_line(aes(color = variable)) +
  geom_vline(xintercept = 2007, linetype="dashed") +
  geom_text(aes(x = 2007, label="2007", y = 130), nudge_x = 2.3, nudge_y = 1.5) + labs(title = "e: Marital status (ages 15 - 44)") +
  scale_color_discrete(name = "Marital Status",
                       limits = c("brate_unmarried", "brate_married"),
                       labels = c("Unmarried", "Married")) +
  scale_x_continuous(name = NULL, breaks = c(1980, 1985, 1990, 1995, 2000, 2005, 2010, 2015, 2020)) +
  scale_y_continuous(name = "Births per 1,000 women for different marital status", breaks = c(0, 20, 40, 60, 80, 100, 120, 140), limits = c(0, 140)) +
  theme_minimal() +
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank())
```

\newpage

# Data
We created a table using the `kable` function from the `knitr` package [@citeknitr] to show the first 10 observations of one of the datasets we used (Table 1). This table contains columns recording years and birth rates of different age groups of females.

```{r Table1, echo = FALSE, warning=FALSE}
# Create a table to take a glimpse of some of our data
library(knitr)

fig_2ab_data %>%
  select(year, brate_1519, brate_2024, brate_2529, brate_3034, brate_3539, brate_4044) %>%
  slice(1:10) %>%
  kable(caption = "First 10 rows of our dataset showing birth rate per year per age group of females")
```
From Table \@ref(tab:Table1), we observed birth rates of different age groups of females from 1980 to 1989. We then created a line graph using `ggplot2` package [@citeggplot2] to get an insight on how birth rates changed for females from different races specifically after 2007. 

```{r Figure3, fig.cap="Birth rates by race and ethnicity since the year 2007", echo = FALSE, message=FALSE}
df_2b %>%
  filter(year >= 2007) %>%
  ggplot(aes(x = year, y = value)) + 
  geom_line(aes(color = variable)) + 
  labs(title = "b: Race and ethnicity (ages 15 - 44)") +
  scale_color_discrete(name = "Race and Ethnicity Groups",
                       limits = c("brate_whitenh", "brate_blacknh", "brate_hisp"),
                       labels = c("White, non-Hispanic", "Black, non-Hispanic", "Hispanic")) +
  scale_x_continuous(name = NULL, breaks = c(2007, 2010, 2013, 2016, 2019)) +
  scale_y_continuous(name = "Births per 1,000 women in different race groups", breaks = c(0, 20, 40, 60, 80, 100, 120, 140), limits = c(0, 140)) +
  theme_minimal() +
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank())

```

From Figure \@ref(fig:Figure3), we observed a steady decrease in birth rates for Hispanic females since the year 2007, while the birth rates for white females and black females are relatively steady. Figure 3 indicates that the major contribution to declining US birth rates after 2007 comes from the Hispanic populations, in contrary to Figure 2b which shows that before 2007 the black population also contributed greatly to the declining birth rates in the US. 

Next, we will look at how birth rates changed for females from ages 15 to 29 specifically after 2007.

```{r Figure4, fig.cap="Birth rates for females aged 15 to 29 by age groups since the year 2007", echo=FALSE, warning=FALSE, message=FALSE}
df_2a %>%
  filter(year >= 2007, variable == "brate_1519" | variable == "brate_2024" | variable == "brate_2529") %>%
  ggplot(aes(x = year, y = value)) + 
  geom_line(aes(color = variable)) + 
  labs(title = "a: Five-year age group") +
  scale_color_discrete(name = "Age Group",
                       limits = c("brate_1519", "brate_2024", "brate_2529"),
                       labels = c("Age 15 - 19", "Age 20 - 24", "Age 25 - 29")) +
  scale_x_continuous(name = NULL, breaks = c(2007, 2010, 2013, 2016, 2019)) +
  scale_y_continuous(name = "Births per 1,000 women in different age groups", breaks = c(0, 20, 40, 60, 80, 100, 120, 140), limits = c(0, 140)) +
  theme_minimal() +
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank())
```

From Figure \@ref(fig:Figure4), we observed that females in the US aged 15-19, 20-24, and 25-29 all experienced a steady decline in birth rates since the year 2007. This is different from before 2007 where these 3 groups of females had relatively high, steady birth rates. 

# Model

\begin{equation}
Pr(\theta | y) = \frac{Pr(y | \theta) Pr(\theta)}{Pr(y)}  (\#eq:bayes)
\end{equation}

Equation \@ref(eq:bayes) seems useful, eh?

Here's a dumb example of how to use some references: In paper we run our analysis in `R` [@citeR]. We also use the `tidyverse` which was written by @thereferencecanbewhatever If we were interested in baseball data then @citeLahman could be useful. 

We can use maths by including latex between dollar signs, for instance $\theta$.


# Results

# Discussion

## First discussion point

If my paper were 10 pages, then should be be at least 2.5 pages. The discussion is a chance to show off what you know and what you learnt from all this. 

## Second discussion point

## Third discussion point

## Weaknesses and next steps

Weaknesses and next steps should also be included.

\newpage

\appendix

# Appendix {-}


# Additional details


\newpage


# References


